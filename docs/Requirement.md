# 요구사항 분석

## 요구사항

1️⃣ **`주요`** **잔액 충전 / 조회 API**

- 결제에 사용될 금액을 충전하는 API 를 작성합니다.
- 사용자 식별자 및 충전할 금액을 받아 잔액을 충전합니다.
- 사용자 식별자를 통해 해당 사용자의 잔액을 조회합니다.

2️⃣ **`기본` 상품 조회 API**

- 상품 정보 ( ID, 이름, 가격, 잔여수량 ) 을 조회하는 API 를 작성합니다.
- 조회시점의 상품별 잔여수량이 정확하면 좋습니다.

3️⃣ **`주요` 선착순 쿠폰 기능**

- 선착순 쿠폰 발급 API 및 보유 쿠폰 목록 조회 API 를 작성합니다.
- 사용자는 선착순으로 할인 쿠폰을 발급받을 수 있습니다.
- 주문 시에 유효한 할인 쿠폰을 함께 제출하면, 전체 주문금액에 대해 할인 혜택을 부여받을 수 있습니다.

4️⃣ **`주요`** **주문 / 결제 API**

- 사용자 식별자와 (상품 ID, 수량) 목록을 입력받아 주문하고 결제를 수행하는 API 를 작성합니다.
- 결제는 기 충전된 잔액을 기반으로 수행하며 성공할 시 잔액을 차감해야 합니다.
- 데이터 분석을 위해 결제 성공 시에 실시간으로 주문 정보를 데이터 플랫폼에 전송해야 합니다. ( 데이터 플랫폼이 어플리케이션 `외부` 라는 가정만 지켜 작업해 주시면 됩니다 )

> 데이터 플랫폼으로의 전송 기능은 Mock API, Fake Module 등 다양한 방법으로 접근해 봅니다.
>

5️⃣ **`기본` 상위 상품 조회 API**

- 최근 3일간 가장 많이 팔린 상위 5개 상품 정보를 제공하는 API 를 작성합니다.
- 통계 정보를 다루기 위한 기술적 고민을 충분히 해보도록 합니다.
---
## 사용자

### 정책
- 사용자는 잔액정보를 가지고 있으며 이를 통해 결제를 진행합니다.
- 잔액은 충전 및 사용할 수 있으며 결제시에 사용할 수 있습니다.
- 잔액 충전 / 사용시 음수 금액을 허용하지 않습니다.
- 잔액은 10,000원 이상 부터 충전이 가능합니다.
- 잔액은 10,000,000원 이상 보유할 수 없습니다.
- 잔액 충전 / 사용시 히스토리 파악을 위해 충전 / 사용 내역을 저장해야 합니다.

### 기술 요구사항

- 사용자가 동시에 충전 및 사용하는 경우는 극히 드물것으로 판단하여 충돌이 거의 없을 것으로 판단하여 낙관적락을 사용한다.

---

## 상품

### 정책

- 상품은 결제 완료시 잔여 수량이 차감됩니다.
- 상품별 잔여 수량은 최신 상태로 유지되어야 하며, 음수가 될 수 없습니다.
- 상품의 가격은 0이거나 음수일 수 없습니다.
- 상품의 인기 상품 정보는 최근 3일간 가장 많이 결제 완료된 상위 5개의 상품 정보를 제공해야 합니다.

### 기술 요구사항

- 상품의 잔여 수량은 최대한 정확한 정보를 제공해야하므로 비관적락을 통해 해결한다.
- 상품의 인기 정보를 제공하기 위해 00시 00분 마다 3일간 가장 많이 결제 완료된 상위 5개의 상품 정보를 보여주는 테이블을 제공합니다.

---

## 쿠폰

### 정책

- 쿠폰은 하나의 주문에 하나의 쿠폰만 적용할 수 있습니다.
- 쿠폰은 주문 시점에 만료 시간이 지난 경우 사용할 수 없습니다.
- 쿠폰은 총 주문 금액에서 할인을 적용할 수 있습니다.
- 쿠폰 적용 후 최종 주문 금액은 0원 이하가 될 수 없습니다.
- 쿠폰 상태는 다음과 같이 정의됩니다.
    - 사용 가능 상태
    - 사용 완료 상태
    - 만료 상태
    - 취소 상태
- 쿠폰 사용은 사용가능 상태일 때만 가능합니다.
- 쿠폰은 쿠폰 정책에 따라 발급됩니다.
- 쿠폰 정책의 발행 시작 시간 이후, 발행 종료 시간 이전 동안 쿠폰을 발급받을 수 있습니다.
- 할인 유형은 금액, 비율로 나뉩니다.
- 발행한 쿠폰 개수는 발행할 쿠폰 개수보다 작아야합니다.
- 같은 정책을 가진 쿠폰은 한사람당 하나만 발행할 수 있습니다.

### 기술 요구사항

- 발행한 쿠폰 개수는 한꺼번에 많은 요청이 발생할 수 있기 때문에 비관적락을 통해 해결한다.

---

## 주문

### 정책

- 주문시 재고상태를 확인하여 주문이 가능한지 확인합니다.
- 주문할 때 쿠폰 적용 여부를 결정합니다.
- 쿠폰 적용 후 주문 가격은 0원 이하가 될 수 없습니다.

---

## 결제

### 정책

- 결제 금액은 음수가 될 수 없습니다.
- 현재 결제 유형은 잔액만 존재합니다.
- 결제에 성공하면 재고를 차감합니다.
- 결제 상태는 다음과 같은 정의됩니다.
    - 결제 완료
    - 결제 실패
    - 결제 취소

### 기술 요구사항

- 외부 데이터 플랫폼으로 결제 정보를 전송을 하기 위해 Fake 구현을 사용합니다.