# ğŸ“Œ ë¶€í•˜ í…ŒìŠ¤íŠ¸ ê³„íš (ì¿ í° ë°œê¸‰ API)

## **1. API ì„¤ëª…**

- `POST /api/v1/users/{userId}/coupons` ë¥¼ í˜¸ì¶œí•˜ì—¬ ì¿ í° ë°œê¸‰ ìš”ì²­ì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    - `{userId}`ì— í•´ë‹¹í•˜ëŠ” ì‚¬ìš©ìì—ê²Œ ì¿ í° ë°œê¸‰ ìš”ì²­ì„ í•©ë‹ˆë‹¤.
    - API í˜¸ì¶œ ì‹œ **Authorization í—¤ë”**ì— `userId` ì •ë³´ë¥¼ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤.
    - ì¿ í° ìš”ì²­ì€ **Redis Sorted Set**ì„ í™œìš©í•˜ì—¬ ì €ì¥ë˜ë©°, ìŠ¤ì¼€ì¤„ëŸ¬ë¥¼ í†µí•´ ì‹¤ì œ ë°œê¸‰ì´ ì§„í–‰ë©ë‹ˆë‹¤.

---

## **2. í…ŒìŠ¤íŠ¸ ê°€ì • (Traffic Assumption)**

### **ğŸ“Š ì‚¬ìš©ì íŠ¸ë˜í”½ ê°€ì •**

| í•­ëª©                  | ìˆ˜ì¹˜       | ì„¤ëª…                   |
|---------------------|----------|----------------------|
| **MAU** (ì›”ê°„ í™œì„± ì‚¬ìš©ì) | 50ë§Œ ëª…    | ë¶€í•˜ í…ŒìŠ¤íŠ¸ ê·œëª¨ì— ë§ì¶˜ MAU ì„¤ì • |
| **DAU** (ì¼ê°„ í™œì„± ì‚¬ìš©ì) | 5ë§Œ ëª…     | MAUì˜ 10%             |
| **ì´ë²¤íŠ¸ ìˆœê°„ ë™ì‹œ ì ‘ì†ì**   | DAUì˜ 10% | ë¶€í•˜ í…ŒìŠ¤íŠ¸ ê¸°ì¤€ (5,000ëª…)   |

### **ğŸš€ ì˜ˆìƒë˜ëŠ” ë¶€í•˜**

- **10ì´ˆ ë™ì•ˆ 5,000ëª… ìš”ì²­ (DAUì˜ 10%)**
- **ì¿ í° ë°œê¸‰ API íŠ¸ë˜í”½ ì§‘ì¤‘**
- **Redis ë° DB ë¶€í•˜ ì¦ê°€ ì˜ˆìƒ**

---

## **3. í…ŒìŠ¤íŠ¸ í™˜ê²½ (Test Environment)**

### **ğŸ–¥ï¸ ì„œë²„ ìŠ¤í™**

| í•­ëª©            | ë²„ì „                |
|---------------|-------------------|
| **ì–¸ì–´**        | Kotlin 2.1        |
| **í”„ë ˆì„ì›Œí¬**     | Spring Boot 3.4.1 |
| **ë°ì´í„°ë² ì´ìŠ¤**    | MySQL 8.0         |
| **ìºì‹œ**        | Redis 7.4         |
| **ë¶€í•˜ í…ŒìŠ¤íŠ¸ ë„êµ¬** | K6                |

---

## **4. í…ŒìŠ¤íŠ¸ ëª©í‘œ (Test Objectives)**

1. **ìµœëŒ€ íŠ¸ë˜í”½ ì²˜ë¦¬ ê°€ëŠ¥ ì—¬ë¶€ ê²€ì¦**

- **10ì´ˆ ë™ì•ˆ 5,000ëª… ë™ì‹œ ìš”ì²­** ì‹œ APIê°€ ì •ìƒì ìœ¼ë¡œ ë™ì‘í•˜ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.

2. **Redis ë° DB ì„±ëŠ¥ í‰ê°€**

- **Redis Sorted Set**ì„ í™œìš©í•œ ì¿ í° ë°œê¸‰ ìš”ì²­ ì²˜ë¦¬ ì†ë„ ë¶„ì„í•©ë‹ˆë‹¤.

3. **API ì‘ë‹µ ì†ë„ ë° ì˜¤ë¥˜ìœ¨ ë¶„ì„**

- ìš”ì²­ ì‹¤íŒ¨ìœ¨ (`5xx`, `4xx` ì˜¤ë¥˜) **3% ì´í•˜ ìœ ì§€** ëª©í‘œì…ë‹ˆë‹¤.

### 5. í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸

```js
import http from 'k6/http';
import {check, sleep} from 'k6';
import {Trend} from 'k6/metrics';

export let responseTime = new Trend('response_time');

export let options = {
    stages: [
        {duration: '10s', target: 5000},
    ],
};

export default function () {
    let userId = Math.floor(Math.random() * 1000000) + 1;  // 1~100ë§Œ ìœ ì € ëœë¤ ì„ íƒ
    let url = `http://localhost:8080/api/v1/users/${userId}/coupons`;

    let params = {
        headers: {
            'Authorization': `${userId}`,
            'Content-Type': 'application/json'
        },
    };

    let payload = JSON.stringify({
        couponPolicyId: 1
    });

    let res = http.post(url, payload, params);

    responseTime.add(res.timings.duration);
    check(res, {
        'âœ… ì¿ í° ë°œê¸‰ ìš”ì²­ ì„±ê³µ (200)': (r) => r.status === 200,
        'âŒ ì„œë²„ ì˜¤ë¥˜ (500)': (r) => r.status === 500,
    });

    sleep(Math.random() * 0.3);
}

```

### 6. í…ŒìŠ¤íŠ¸ ê²°ê³¼

![img_1.png](images/step19.png)